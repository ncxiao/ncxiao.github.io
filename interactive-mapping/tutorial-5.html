<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Interactive Mapping</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension vscode.markdown-math */
@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.13.24"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
@font-face { font-family: octicons-link; src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff'); } html { /* width: 880px; */ /* padding: 45px; */ margin-top: 25px; margin-bottom: 125px; /* border: 1px solid #ddd; */ /* border-radius: 3px; */ } body { -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; line-height: 1.5; color: #333; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; font-size: 16px; line-height: 1.5; word-wrap: break-word; } body .pl-c { color: #969896; } body .pl-c1, body .pl-s .pl-v { color: #0086b3; } body .pl-e, body .pl-en { color: #795da3; } body .pl-smi, body .pl-s .pl-s1 { color: #333; } body .pl-ent { color: #63a35c; } body .pl-k { color: #a71d5d; } body .pl-s, body .pl-pds, body .pl-s .pl-pse .pl-s1, body .pl-sr, body .pl-sr .pl-cce, body .pl-sr .pl-sre, body .pl-sr .pl-sra { color: #183691; } body .pl-v { color: #ed6a43; } body .pl-id { color: #b52a1d; } body .pl-ii { color: #f8f8f8; background-color: #b52a1d; } body .pl-sr .pl-cce { font-weight: bold; color: #63a35c; } body .pl-ml { color: #693a17; } body .pl-mh, body .pl-mh .pl-en, body .pl-ms { font-weight: bold; color: #1d3e81; } body .pl-mq { color: #008080; } body .pl-mi { font-style: italic; color: #333; } body .pl-mb { font-weight: bold; color: #333; } body .pl-md { color: #bd2c00; background-color: #ffecec; } body .pl-mi1 { color: #55a532; background-color: #eaffea; } body .pl-mdr { font-weight: bold; color: #795da3; } body .pl-mo { color: #1d3e81; } body .octicon { display: inline-block; vertical-align: text-top; fill: currentColor; } body a { background-color: transparent; -webkit-text-decoration-skip: objects; } body a:active, body a:hover { outline-width: 0; } body strong { font-weight: inherit; } body strong { font-weight: bolder; } body h1 { font-size: 2em; margin: 0.67em 0; } body img { border-style: none; } body svg:not(:root) { overflow: hidden; } body code, body kbd, body pre { font-family: monospace, monospace; font-size: 1em; } body hr { box-sizing: content-box; height: 0; overflow: visible; } body input { font: inherit; margin: 0; } body input { overflow: visible; } body [type="checkbox"] { box-sizing: border-box; padding: 0; } body * { box-sizing: border-box; } body input { font-family: inherit; font-size: inherit; line-height: inherit; } body a { color: #4078c0; text-decoration: none; } body a:hover, body a:active { text-decoration: underline; } body strong { font-weight: 600; } body hr { height: 0; margin: 15px 0; overflow: hidden; background: transparent; border: 0; border-bottom: 1px solid #ddd; } body hr::before { display: table; content: ""; } body hr::after { display: table; clear: both; content: ""; } body table { border-spacing: 0; border-collapse: collapse; } body td, body th { padding: 0; } body h1, body h2, body h3, body h4, body h5, body h6 { margin-top: 0; margin-bottom: 0; } body h1 { font-size: 32px; font-weight: 600; } body h2 { font-size: 24px; font-weight: 600; } body h3 { font-size: 20px; font-weight: 600; } body h4 { font-size: 16px; font-weight: 600; } body h5 { font-size: 14px; font-weight: 600; } body h6 { font-size: 12px; font-weight: 600; } body p { margin-top: 0; margin-bottom: 10px; } body blockquote { margin: 0; } body ul, body ol { padding-left: 0; margin-top: 0; margin-bottom: 0; } body ol ol, body ul ol { list-style-type: lower-roman; } body ul ul ol, body ul ol ol, body ol ul ol, body ol ol ol { list-style-type: lower-alpha; } body dd { margin-left: 0; } body code { font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; font-size: 12px; } body pre { margin-top: 0; margin-bottom: 0; font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace; } body .octicon { vertical-align: text-bottom; } body input { -webkit-font-feature-settings: "liga" 0; font-feature-settings: "liga" 0; } body::before { display: table; content: ""; } body::after { display: table; clear: both; content: ""; } body>*:first-child { margin-top: 0 !important; } body>*:last-child { margin-bottom: 0 !important; } body a:not([href]) { color: inherit; text-decoration: none; } body .anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1; } body .anchor:focus { outline: none; } body p, body blockquote, body ul, body ol, body dl, body table, body pre { margin-top: 0; margin-bottom: 16px; } body hr { height: 0.25em; padding: 0; margin: 24px 0; background-color: #e7e7e7; border: 0; } body blockquote { padding: 0 1em; color: #777; border-left: 0.25em solid #ddd; } body blockquote>:first-child { margin-top: 0; } body blockquote>:last-child { margin-bottom: 0; } body kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: #555; vertical-align: middle; background-color: #fcfcfc; border: solid 1px #ccc; border-bottom-color: #bbb; border-radius: 3px; box-shadow: inset 0 -1px 0 #bbb; } body h1, body h2, body h3, body h4, body h5, body h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25; } body h1 .octicon-link, body h2 .octicon-link, body h3 .octicon-link, body h4 .octicon-link, body h5 .octicon-link, body h6 .octicon-link { color: #000; vertical-align: middle; visibility: hidden; } body h1:hover .anchor, body h2:hover .anchor, body h3:hover .anchor, body h4:hover .anchor, body h5:hover .anchor, body h6:hover .anchor { text-decoration: none; } body h1:hover .anchor .octicon-link, body h2:hover .anchor .octicon-link, body h3:hover .anchor .octicon-link, body h4:hover .anchor .octicon-link, body h5:hover .anchor .octicon-link, body h6:hover .anchor .octicon-link { visibility: visible; } body h1 { padding-bottom: 0.3em; font-size: 2em; border-bottom: 1px solid #eee; } body h2 { padding-bottom: 0.3em; font-size: 1.5em; border-bottom: 1px solid #eee; } body h3 { font-size: 1.25em; } body h4 { font-size: 1em; } body h5 { font-size: 0.875em; } body h6 { font-size: 0.85em; color: #777; } body ul, body ol { padding-left: 2em; } body ul ul, body ul ol, body ol ol, body ol ul { margin-top: 0; margin-bottom: 0; } body li>p { margin-top: 16px; } body li+li { margin-top: 0.25em; } body dl { padding: 0; } body dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; } body dl dd { padding: 0 16px; margin-bottom: 16px; } body table { display: block; width: 100%; overflow: auto; } body table th { font-weight: bold; } body table th, body table td { padding: 6px 13px; border: 1px solid #ddd; } body table tr { background-color: #fff; border-top: 1px solid #ccc; } /* body table tr:nth-child(2n) { background-color: #f8f8f8; } */ body img { max-width: 100%; box-sizing: content-box; background-color: #fff; } body code { padding: 0; padding-top: 0.2em; padding-bottom: 0.2em; margin: 0; font-size: 85%; background-color: rgba(0,0,0,0.04); border-radius: 3px; } body code::before, body code::after { letter-spacing: -0.2em; content: "\00a0"; } body pre { word-wrap: normal; } body pre>code { padding: 0; margin: 0; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0; } body .highlight { margin-bottom: 16px; } body .highlight pre { margin-bottom: 0; word-break: normal; } body .highlight pre, body pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: #f7f7f7; border-radius: 3px; } body pre code { display: inline; max-width: auto; padding: 0; margin: 0; overflow: visible; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } body pre code::before, body pre code::after { content: normal; } body .pl-0 { padding-left: 0 !important; } body .pl-1 { padding-left: 3px !important; } body .pl-2 { padding-left: 6px !important; } body .pl-3 { padding-left: 12px !important; } body .pl-4 { padding-left: 24px !important; } body .pl-5 { padding-left: 36px !important; } body .pl-6 { padding-left: 48px !important; } body .full-commit .btn-outline:not(:disabled):hover { color: #4078c0; border: 1px solid #4078c0; } body kbd { display: inline-block; padding: 3px 5px; font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace; line-height: 10px; color: #555; vertical-align: middle; background-color: #fcfcfc; border: solid 1px #ccc; border-bottom-color: #bbb; border-radius: 3px; box-shadow: inset 0 -1px 0 #bbb; } body :checked+.radio-label { position: relative; z-index: 1; border-color: #4078c0; } body .task-list-item { list-style-type: none; } body .task-list-item+.task-list-item { margin-top: 3px; } body .task-list-item input { margin: 0 0.2em 0.25em -1.6em; vertical-align: middle; } body hr { border-bottom-color: #eee; } 
</style>
    </head>
    <body class="vscode-body vscode-light">
        <p>Tutorials: <a href="tutorial-1.html">HTML/CSS/JS</a> | <a href="tutorial-2.html">Leaflet</a> | <a href="tutorial-3.html">D3</a> | <a href="tutorial-4.html">Visualizing spatial-temporal data 1</a> | Visualizing spatial-temporal data 2</p>
<h1 id="interactive-mapping">Interactive Mapping</h1>
<h2 id="tutorial-5-more-interactive-visualization-of-spatial-temporal-data">Tutorial 5. More Interactive Visualization of Spatial-Temporal Data</h2>
<p><em>Ningchuan Xiao</em></p>
<p>The goals of this workshop include</p>
<ul>
<li>Color scale in d3</li>
<li>Linking multiple graphs using d3 and leaflet</li>
</ul>
<h2 id="spatial-temporal-data">Spatial-temporal data</h2>
<p>We are going to use the data of 24 hours of Blitz (bombing of London) on September 7, 1940. The data source is <a href="http://bombsight.org/data/sources/">http://bombsight.org/data/sources/</a>. A former student, Maxfield Barach, has geocoded the original data and reported that only 708 of the 843 bomb sights can be geocoded. My further clean-up of the data found that only 706 were good. This data is saved in a tab separated file (TSV) and the first three lines are like this:</p>
<pre><code><code><div>order	time	location	type	details	lng	lat
1	0:08	43 Southwark Park Road, SE16, London, UK	IB	Grocers: 3x2 roof damaged	-0.068463	51.494531
2	0:10	49 Southwark Park road, Bermondsey, SE16, London, UK	IB	Bakers: 3x2 roof damaged	-0.058463	51.494532
</div></code></code></pre>
<p>The link to this file is <a href="pages/bombs.tsv">here</a>.</p>
<h2 id="map-the-bombs">Map the bombs</h2>
<p>We first need to write the following HTML file. Let's call it <strong>bombs5.html</strong>. Note that in addition to what we have used so far, a new library is used here. It is the <strong>jquery</strong> library and we will use its <code>inArray</code> function to test if a value is in an array.</p>
<pre><code class="language-html"><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
            <span class="hljs-selector-id">#map</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">350px</span>; }

            <span class="hljs-selector-class">.axis</span> path,
            <span class="hljs-selector-class">.axis</span> line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }

            <span class="hljs-selector-class">.bar</span> {
                shape-rendering: crispEdges;
            }

            <span class="hljs-selector-class">.axis</span> text {
                <span class="hljs-attribute">font-family</span>: sans-serif;
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
            }

            <span class="hljs-selector-class">.x</span><span class="hljs-selector-class">.axis</span> path {
                <span class="hljs-attribute">display</span>: none;
            }

        </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>D3 Test<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://d3js.org/d3.v3.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://code.jquery.com/jquery-3.0.0.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>24 hours of Blitz Sept 7th 1940: Map and Time<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:right&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bombstype&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;timehisto&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;bombs5.js&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;debug&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<p>Now as indicated in the above HTML file, we write the javascript file called <strong>bombs5.js</strong>.</p>
<pre><code class="language-js"><div><span class="hljs-comment">// This is where we put the good stuff using D3</span>

<span class="hljs-comment">// Data source: http://bombsight.org/data/sources/</span>
<span class="hljs-comment">// 24 hours of Blitz Sept 7th 1940</span>


<span class="hljs-keyword">var</span> bombs_data;
<span class="hljs-keyword">var</span> bombs_geojson;
<span class="hljs-keyword">var</span> hourBins;

<span class="hljs-keyword">var</span> layer_geojsons = {};

<span class="hljs-keyword">var</span> svg;
<span class="hljs-keyword">var</span> rects;
<span class="hljs-keyword">var</span> map;
<span class="hljs-keyword">var</span> bombs_layer;

<span class="hljs-keyword">var</span> bombs_types = {};
<span class="hljs-keyword">var</span> bombs_types_array;
<span class="hljs-keyword">var</span> cat_keys;

<span class="hljs-keyword">var</span> cat_svg;
<span class="hljs-keyword">var</span> cat_rects;

<span class="hljs-keyword">var</span> c10;

<span class="hljs-keyword">var</span> histData;

<span class="hljs-comment">//</span>
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span>  ll_ids needs to be handled as ll_ids2</span>
<span class="hljs-comment">//        This will enable highlighting type barchart when hovering on time chart</span>
<span class="hljs-comment">//</span>
<span class="hljs-keyword">var</span> ll_ids;
<span class="hljs-keyword">var</span> ll_ids2 = {};   <span class="hljs-comment">// ids linked to the barchart: barchart id -&gt; time chart ids, layer ids.</span>

<span class="hljs-keyword">var</span> parseTime = d3.time.format(<span class="hljs-string">&quot;%B %d, %Y %I:%M %Z&quot;</span>).parse;

<span class="hljs-keyword">var</span> bisectTime = d3.bisector(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d; }).left;

<span class="hljs-keyword">var</span> default_bombs_style = {
    <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;none&quot;</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">fillColor</span>: <span class="hljs-string">&quot;steelblue&quot;</span>,
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">fillOpacity</span>: <span class="hljs-number">0.6</span>,
    <span class="hljs-attr">weight</span>: <span class="hljs-number">0</span>
};

<span class="hljs-keyword">var</span> highlight_bombs_style = {
    <span class="hljs-attr">fillColor</span>: <span class="hljs-string">&#x27;yellow&#x27;</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;grey&quot;</span>,
    <span class="hljs-attr">fillOpacity</span>: <span class="hljs-number">0.8</span>,
    <span class="hljs-attr">weight</span>: <span class="hljs-number">2</span>
}

d3.tsv(<span class="hljs-string">&quot;bombs.tsv&quot;</span>, handle_bombs);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle_bombs</span>(<span class="hljs-params">error, data</span>) </span>{

    bombs_geojson = {
    	<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FeatureCollection&quot;</span>,
    	<span class="hljs-string">&quot;features&quot;</span>: []
    };

    data.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
		d.id = i;
        d.order = +d[<span class="hljs-string">&quot;order&quot;</span>];
        d.lng = +d.lng;
        d.lat = +d.lat;
        d.type = (d.type==<span class="hljs-string">&quot;-&quot;</span>?<span class="hljs-string">&quot;Other&quot;</span>:d.type);
        d.time = parseTime(<span class="hljs-string">&quot;September 7, 1940 &quot;</span> + d.time + <span class="hljs-string">&quot; -0400&quot;</span>);

    	bombs_geojson.features[i] = {
    	    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Feature&quot;</span>,
    	    <span class="hljs-string">&quot;geometry&quot;</span>: {
    		    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Point&quot;</span>,
                <span class="hljs-string">&quot;coordinates&quot;</span>: [d.lng, d.lat]
    	    },
    	    <span class="hljs-string">&quot;properties&quot;</span>: {
                <span class="hljs-string">&quot;id&quot;</span>: i
    	    }
    	};

		<span class="hljs-keyword">if</span> (d.type <span class="hljs-keyword">in</span> bombs_types) {
			bombs_types[d.type] += <span class="hljs-number">1</span>;
        }
		<span class="hljs-keyword">else</span> {
			bombs_types[d.type] = <span class="hljs-number">1</span>;
        }

    });

    bombs_data = data;

	cat_keys = <span class="hljs-built_in">Object</span>.keys(bombs_types);
	bombs_types_array = cat_keys.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{ <span class="hljs-keyword">return</span> [v, bombs_types[v]]; });

    cat_keys.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
        ll_ids2[d] = {
            <span class="hljs-attr">layer_ids</span>: [],
            <span class="hljs-attr">time_ids</span>: []
        };
    });

    c10 = d3.scale.category10().domain(cat_keys);

	make_timechart();
    make_barchart();
    make_maps();

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_barchart</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">var</span> total_w = <span class="hljs-number">500</span>;
    <span class="hljs-keyword">var</span> total_h = <span class="hljs-number">200</span>;

    <span class="hljs-keyword">var</span> margin = {<span class="hljs-attr">top</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>};
    <span class="hljs-keyword">var</span> w = total_w - margin.left - margin.right;
    <span class="hljs-keyword">var</span> h = total_h - margin.top - margin.bottom;

    cat_svg = d3.select(<span class="hljs-string">&quot;#bombstype&quot;</span>)
        .append(<span class="hljs-string">&quot;svg&quot;</span>)
        .attr(<span class="hljs-string">&quot;width&quot;</span>, w + margin.left + margin.right)
        .attr(<span class="hljs-string">&quot;height&quot;</span>, h + margin.top + margin.bottom);

    <span class="hljs-keyword">var</span> yScale = d3.scale.linear().
        domain([<span class="hljs-number">0</span>, d3.max(bombs_types_array, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d[<span class="hljs-number">1</span>]; })]).
        range([h, margin.top]);

    <span class="hljs-keyword">var</span> yAxis = d3.svg.axis()
        .scale(yScale)
        .orient(<span class="hljs-string">&quot;left&quot;</span>)
        .ticks(<span class="hljs-number">3</span>);

    xScale = d3.scale.ordinal()
        .domain(bombs_types_array.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d[<span class="hljs-number">0</span>]; }))
        <span class="hljs-comment">// .domain(keys)</span>
        .rangeRoundBands([margin.left, w], <span class="hljs-number">0.05</span>);

    xAxis = d3.svg.axis()
        .scale(xScale)
        .orient(<span class="hljs-string">&quot;bottom&quot;</span>);

    cat_rects = cat_svg.selectAll(<span class="hljs-string">&quot;rect&quot;</span>)
        .data(bombs_types_array)
        .enter()
        .append(<span class="hljs-string">&quot;rect&quot;</span>)
    	.attr(<span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;barchart&quot;</span>)
        .attr(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{<span class="hljs-keyword">return</span> xScale(d[<span class="hljs-number">0</span>]);})
        .attr(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{<span class="hljs-keyword">return</span> yScale(d[<span class="hljs-number">1</span>]);} )
        .attr(<span class="hljs-string">&quot;height&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{<span class="hljs-keyword">return</span> h-yScale(d[<span class="hljs-number">1</span>]);})
        .attr(<span class="hljs-string">&quot;width&quot;</span>, xScale.rangeBand())
        .attr(<span class="hljs-string">&quot;fill&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{<span class="hljs-keyword">return</span> c10(d[<span class="hljs-number">0</span>]);});

    cat_rects.on(<span class="hljs-string">&quot;mouseover&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
            d3.select(<span class="hljs-built_in">this</span>).style(<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-string">&#x27;yellow&#x27;</span>);
    		d3.select(<span class="hljs-string">&quot;#debug&quot;</span>).html(<span class="hljs-string">&quot;over: &quot;</span> + d + <span class="hljs-string">&quot;, &quot;</span> + i);
            bombs_layer.eachLayer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">layer</span>) </span>{
                layer.setStyle({<span class="hljs-attr">fillColor</span> :<span class="hljs-string">&#x27;#afafaf&#x27;</span>})
            });
            ll_ids2[d[<span class="hljs-number">0</span>]].layer_ids.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dd</span>) </span>{
                l = bombs_layer.getLayer(dd);
                bombs_layer.resetStyle(l);
        		<span class="hljs-keyword">if</span> (!L.Browser.ie &amp;&amp; !L.Browser.opera) {
        		    l.bringToFront();
        		}
            });
    	    d3.selectAll(<span class="hljs-string">&quot;.timechart&quot;</span>)
        		.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dd, ii</span>) </span>{<span class="hljs-keyword">return</span> ($.inArray(ii, ll_ids2[d[<span class="hljs-number">0</span>]].time_ids)!=-<span class="hljs-number">1</span>); })
        		.style(<span class="hljs-string">&quot;fill&quot;</span>, highlight_bombs_style[<span class="hljs-string">&quot;fillColor&quot;</span>]);
    	})
    	.on(<span class="hljs-string">&quot;mouseout&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
            d3.select(<span class="hljs-built_in">this</span>).style(<span class="hljs-string">&quot;fill&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{<span class="hljs-keyword">return</span> c10(d[<span class="hljs-number">0</span>]);});
            bombs_layer.eachLayer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">layer</span>) </span>{
                bombs_layer.resetStyle(layer);
            });
    	    d3.selectAll(<span class="hljs-string">&quot;.timechart&quot;</span>)
        		.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dd, ii</span>) </span>{<span class="hljs-keyword">return</span> ($.inArray(ii, ll_ids2[d[<span class="hljs-number">0</span>]].time_ids)!=-<span class="hljs-number">1</span>); })
        		.style(<span class="hljs-string">&quot;fill&quot;</span>, default_bombs_style[<span class="hljs-string">&quot;fillColor&quot;</span>]);
    	})

    cat_svg.append(<span class="hljs-string">&quot;g&quot;</span>)
        .attr(<span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;axis&quot;</span>)
        .attr(<span class="hljs-string">&quot;transform&quot;</span>, <span class="hljs-string">&quot;translate(&quot;</span> + margin.left + <span class="hljs-string">&quot;,&quot;</span> + <span class="hljs-number">0</span> +<span class="hljs-string">&quot;)&quot;</span>)
        .call(yAxis);

    cat_svg.append(<span class="hljs-string">&quot;g&quot;</span>)
        .attr(<span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;x axis&quot;</span>)
        .attr(<span class="hljs-string">&quot;transform&quot;</span>, <span class="hljs-string">&quot;translate(0,&quot;</span> + h + <span class="hljs-string">&quot;)&quot;</span>)
        .call(xAxis)
        .selectAll(<span class="hljs-string">&quot;text&quot;</span>)
        .attr(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-number">5</span>)
        .attr(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-number">5</span>)
        .attr(<span class="hljs-string">&quot;transform&quot;</span>, <span class="hljs-string">&quot;rotate(45)&quot;</span>)
        .style(<span class="hljs-string">&quot;text-anchor&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_timechart</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">var</span> total_w = <span class="hljs-number">500</span>;
    <span class="hljs-keyword">var</span> total_h = <span class="hljs-number">200</span>;

    <span class="hljs-keyword">var</span> margin = {<span class="hljs-attr">top</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">60</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>};
    <span class="hljs-keyword">var</span> w = total_w - margin.left - margin.right;
    <span class="hljs-keyword">var</span> h = total_h - margin.top - margin.bottom;

    <span class="hljs-keyword">var</span> formatTime = d3.time.format(<span class="hljs-string">&quot;%H&quot;</span>);

    <span class="hljs-keyword">var</span> hourExtent = d3.extent(bombs_data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.time; });

    <span class="hljs-comment">// one bin per hour, for 24 hours in the day</span>
    hourBins = d3.time.hours(d3.time.hour.offset(hourExtent[<span class="hljs-number">0</span>],-<span class="hljs-number">1</span>),
                                 d3.time.hour.offset(hourExtent[<span class="hljs-number">1</span>],<span class="hljs-number">1</span>));

    <span class="hljs-comment">// a function to bin the data</span>
    <span class="hljs-keyword">var</span> binByHour = d3.layout.histogram()
    	.value(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.time; })
    	.bins(hourBins);

    <span class="hljs-comment">// construct the data for histogram</span>
    histData = binByHour(bombs_data);

    histData.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
        d.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dd, ii</span>) </span>{
            <span class="hljs-keyword">if</span> ($.inArray(i, ll_ids2[dd.type].time_ids) == -<span class="hljs-number">1</span>)
            <span class="hljs-comment">// if (! (i in ll_ids2[dd.type].time_ids))</span>
                ll_ids2[dd.type].time_ids.push(i);
        });
    });

    <span class="hljs-keyword">var</span> svg = d3.select(<span class="hljs-string">&quot;#timehisto&quot;</span>)
    	.append(<span class="hljs-string">&quot;svg&quot;</span>)
    	.attr(<span class="hljs-string">&quot;width&quot;</span>, w + margin.left + margin.right)
    	.attr(<span class="hljs-string">&quot;height&quot;</span>, h + margin.top + margin.bottom)
    	.append(<span class="hljs-string">&quot;g&quot;</span>)
    	.attr(<span class="hljs-string">&quot;transform&quot;</span>, <span class="hljs-string">&quot;translate(&quot;</span> + margin.left + <span class="hljs-string">&quot;,&quot;</span> + margin.top + <span class="hljs-string">&quot;)&quot;</span>);

    <span class="hljs-keyword">var</span> x = d3.time.scale().domain(d3.extent(hourBins)).range([<span class="hljs-number">0</span>, w]);
    <span class="hljs-keyword">var</span> xAxis = d3.svg.axis().scale(x).orient(<span class="hljs-string">&quot;bottom&quot;</span>).tickFormat(formatTime);

    <span class="hljs-keyword">var</span> y = d3.scale.linear().domain([<span class="hljs-number">0</span>, d3.max(histData, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.y; })]).range([h, <span class="hljs-number">0</span>]);
    <span class="hljs-keyword">var</span> yAxis = d3.svg.axis().scale(y).orient(<span class="hljs-string">&quot;left&quot;</span>).ticks(<span class="hljs-number">6</span>);

    rects = svg.selectAll(<span class="hljs-string">&quot;rect&quot;</span>)
    	.data(histData)
    	.enter()
    	.append(<span class="hljs-string">&quot;rect&quot;</span>)
    	.attr(<span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;timechart&quot;</span>)
        .style(<span class="hljs-string">&quot;fill&quot;</span>, default_bombs_style[<span class="hljs-string">&quot;fillColor&quot;</span>])
    	.attr(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> x(d.x); })
    	.attr(<span class="hljs-string">&quot;width&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> x(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d.x.getTime() + d.dx))-x(d.x)-<span class="hljs-number">1</span>; })
    	.attr(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> y(d.y); })
    	.attr(<span class="hljs-string">&quot;height&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> h - y(d.y); });

    rects.on(<span class="hljs-string">&quot;mouseover&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
    		d3.select(<span class="hljs-built_in">this</span>).style(<span class="hljs-string">&quot;fill&quot;</span>, highlight_bombs_style[<span class="hljs-string">&quot;fillColor&quot;</span>]);
    		d3.select(<span class="hljs-string">&quot;#debug&quot;</span>).html(<span class="hljs-string">&quot;over: &quot;</span> + d.length + <span class="hljs-string">&quot; &quot;</span> + d + <span class="hljs-string">&quot;, &quot;</span> + i);
            bombs_layer.eachLayer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">layer</span>) </span>{
                layer.setStyle({<span class="hljs-attr">fillColor</span> :<span class="hljs-string">&#x27;#ababab&#x27;</span>})
            });
            ll_ids[i].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dd</span>) </span>{
                bombs_layer.resetStyle(bombs_layer.getLayer(dd));
                l = bombs_layer.getLayer(dd);
        		<span class="hljs-keyword">if</span> (!L.Browser.ie &amp;&amp; !L.Browser.opera) {
        		    l.bringToFront();
        		}
            });
    	})
    	.on(<span class="hljs-string">&quot;mouseout&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{
    		d3.select(<span class="hljs-built_in">this</span>).style(<span class="hljs-string">&quot;fill&quot;</span>, default_bombs_style[<span class="hljs-string">&quot;fillColor&quot;</span>]);
    		d3.select(<span class="hljs-string">&quot;#debug&quot;</span>).html(<span class="hljs-string">&quot;OUT: &quot;</span> + d.length + <span class="hljs-string">&quot; &quot;</span> + d[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;id&quot;</span>] + <span class="hljs-string">&quot;, &quot;</span> + i);
            bombs_layer.eachLayer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">layer</span>) </span>{
                bombs_layer.resetStyle(layer);
            });
    	});

    svg.append(<span class="hljs-string">&quot;g&quot;</span>)
    	.attr(<span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;x axis&quot;</span>)
    	.attr(<span class="hljs-string">&quot;transform&quot;</span>, <span class="hljs-string">&quot;translate(0,&quot;</span> + h + <span class="hljs-string">&quot;)&quot;</span>)
    	.call(xAxis);

    svg.append(<span class="hljs-string">&quot;g&quot;</span>)
    	.attr(<span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;y axis&quot;</span>)
    	.call(yAxis)
    	.append(<span class="hljs-string">&quot;text&quot;</span>)
    	.attr(<span class="hljs-string">&quot;transform&quot;</span>, <span class="hljs-string">&quot;rotate(-90)&quot;</span>)
    	.attr(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-number">6</span>)
    	.attr(<span class="hljs-string">&quot;dy&quot;</span>, <span class="hljs-string">&quot;.71em&quot;</span>)
    	.style(<span class="hljs-string">&quot;text-anchor&quot;</span>, <span class="hljs-string">&quot;end&quot;</span>)
    	.text(<span class="hljs-string">&quot;Number of Bombs&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onEachBombsFeature</span>(<span class="hljs-params">feature, layer</span>) </span>{
    <span class="hljs-comment">// find the bin that contains this point and push the id to ll_ids</span>
    id = L.stamp(layer);
    i = bisectTime(hourBins, bombs_data[feature.properties.id].time) - <span class="hljs-number">1</span>;
    ll_ids[i].push(id);
    ll_ids2[bombs_data[feature.properties.id].type].layer_ids.push(id);
    layer.on({
        <span class="hljs-attr">mouseover</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    	    <span class="hljs-keyword">var</span> layer = e.target;
            feature = layer.feature;
            feature_id = feature.properties.id;
            <span class="hljs-keyword">var</span> t = bombs_data[feature_id].time;
            <span class="hljs-keyword">var</span> cat = bombs_data[feature_id].type;
            <span class="hljs-comment">// highlight more on self</span>
    		layer.setStyle(highlight_bombs_style);
    	    layer.setStyle({
                <span class="hljs-attr">radius</span>: default_bombs_style[<span class="hljs-string">&quot;radius&quot;</span>]+<span class="hljs-number">3</span>
            });
    		<span class="hljs-keyword">if</span> (!L.Browser.ie &amp;&amp; !L.Browser.opera) {
    		    layer.bringToFront();
    		}

            d3.select(<span class="hljs-string">&quot;#debug&quot;</span>).html(t + <span class="hljs-string">&quot;: &quot;</span> + bombs_data[feature_id].details);
    	    d3.selectAll(<span class="hljs-string">&quot;rect&quot;</span>)
        		.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{dt=t-d.x; <span class="hljs-keyword">return</span> (d[<span class="hljs-number">0</span>]==cat || (dt &lt; d.dx &amp;&amp; dt&gt;=<span class="hljs-number">0</span>)); })
        		.style(<span class="hljs-string">&quot;fill&quot;</span>, highlight_bombs_style[<span class="hljs-string">&quot;fillColor&quot;</span>]);
        },
        <span class="hljs-attr">mouseout</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
	        bombs_layer.resetStyle(e.target);
            <span class="hljs-keyword">var</span> t = bombs_data[feature_id].time;
            <span class="hljs-keyword">var</span> cat = bombs_data[feature_id].type;
            hist_index = bisectTime(hourBins, t) - <span class="hljs-number">1</span>;
    	    ll_ids[hist_index].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dd</span>) </span>{
                bombs_layer.resetStyle(bombs_layer.getLayer(dd));})
    	    d3.selectAll(<span class="hljs-string">&quot;.timechart&quot;</span>)
        		.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{dt=t-d.x; <span class="hljs-keyword">return</span> (dt &lt; d.dx &amp;&amp; dt&gt;=<span class="hljs-number">0</span>); })
        		<span class="hljs-comment">// .filter(function(d, i) {dt=t-d.x; return (dt &lt; d.dx &amp;&amp; dt&gt;=0); })</span>
        		.style(<span class="hljs-string">&quot;fill&quot;</span>, <span class="hljs-string">&quot;steelblue&quot;</span>);
    	    d3.selectAll(<span class="hljs-string">&quot;.barchart&quot;</span>)
        		.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{dt=t-d.x; <span class="hljs-keyword">return</span> (d[<span class="hljs-number">0</span>]==cat); })
        		<span class="hljs-comment">// .filter(function(d, i) {dt=t-d.x; return (dt &lt; d.dx &amp;&amp; dt&gt;=0); })</span>
        		.style(<span class="hljs-string">&quot;fill&quot;</span>, c10(cat));
        }
    })
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_maps</span>(<span class="hljs-params"></span>) </span>{
    map = L.map(<span class="hljs-string">&#x27;map&#x27;</span>);
    map.setView([<span class="hljs-number">51.5</span>, -<span class="hljs-number">0.1</span>], <span class="hljs-number">10</span>);

    <span class="hljs-comment">// create an OpenStreetMap tile layer</span>
    <span class="hljs-keyword">var</span> osmMapnik = L.tileLayer(<span class="hljs-string">&#x27;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#x27;</span>, {
        <span class="hljs-attr">attribution</span>: <span class="hljs-string">&#x27;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;contributors&#x27;</span>
    });

    <span class="hljs-comment">// create another layer using the cartodb service</span>
    <span class="hljs-keyword">var</span> cartoLight = L.tileLayer(<span class="hljs-string">&quot;https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png&quot;</span>, {
        <span class="hljs-attr">attribution</span>: <span class="hljs-string">&#x27;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors, &amp;copy; &lt;a href=&quot;https://cartodb.com/attributions&quot;&gt;CartoDB&lt;/a&gt;&#x27;</span>
    });

    <span class="hljs-keyword">var</span> baseMaps = {
        <span class="hljs-string">&quot;Street map light&quot;</span>: cartoLight,
        <span class="hljs-string">&quot;OpenStreetMap&quot;</span>: osmMapnik
    };

    <span class="hljs-keyword">var</span> layersControl = <span class="hljs-keyword">new</span> L.Control.Layers(baseMaps, <span class="hljs-literal">null</span>, {<span class="hljs-attr">collapsed</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">position</span>: <span class="hljs-string">&#x27;bottomleft&#x27;</span>});
    map.addControl(layersControl);
    map.addLayer(cartoLight, <span class="hljs-literal">true</span>);

    ll_ids = []; <span class="hljs-comment">// leaflet layer ids, very important</span>
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;histData.length; i++)
        ll_ids[i] = [];

    bombs_layer = L.geoJson(bombs_geojson, {
    	<span class="hljs-attr">pointToLayer</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">feature, latlng</span>) </span>{
    	    <span class="hljs-keyword">return</span> L.circleMarker(latlng);
    	},
        <span class="hljs-attr">style</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">feature</span>) </span>{
            c = c10(bombs_data[feature.properties.id].type);
            s = <span class="hljs-built_in">Object</span>.create(default_bombs_style); <span class="hljs-comment">// make a deepcopy, not a reference</span>
            s[<span class="hljs-string">&quot;fillColor&quot;</span>] = c;
            <span class="hljs-keyword">return</span> s;
        },
        <span class="hljs-attr">onEachFeature</span>: onEachBombsFeature
    });

    bombs_layer.addTo(map);
    layersControl.addOverlay(bombs_layer, <span class="hljs-string">&quot;Bombs&quot;</span>);
}
</div></code></pre>
<h2 id="discussion">Discussion</h2>
<p>Any more improvements we can do to make the web app better?</p>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>